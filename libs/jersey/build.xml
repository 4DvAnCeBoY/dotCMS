<project name="Repackager - jersey" default="repackage">

    <property file="${basedir}/../../src/com/liferay/portal/util/build.properties"/>
    <property name="lib.app" value="${basedir}/../../dotCMS/WEB-INF/lib"/>
    <property name="web-inf.dir" value="${basedir}/../../dotCMS/WEB-INF"/>
    <property name="dotcms.dir" value="${basedir}/../../dotCMS"/>
    <property name="src-conf.dir" value="${basedir}/../../src-conf"/>

    <path id="files-classpath">
        <fileset dir="${lib.app}">
            <include name="jarjar-1.4.jar"/>
            <include name="packager-taks.jar"/>
        </fileset>

        <fileset dir="../buildlibs">
            <include name="commons-io-2.0.1.jar"/>
        </fileset>
    </path>

    <target name="clean">
        <delete file="${lib.app}/com.dotcms.repackage.jersey.jar" failonerror="false"/>
        <delete file="${lib.app}/com.dotcms.repackage.jersey-multipart.jar" failonerror="false"/>
        <delete file="${lib.app}/com.dotcms.repackage.jersey-server.jar" failonerror="false"/>
        <delete file="${lib.app}/com.dotcms.repackage.jersey-json.jar" failonerror="false"/>
    </target>

    <target name="repackage" depends="clean">

        <taskdef classname="com.tonicsystems.jarjar.PackagerTask" name="packagerTask">
            <classpath>
                <path refid="files-classpath"/>
            </classpath>
        </taskdef>

        <packagerTask outputFolder="${lib.app}"
                      outputFile="com.dotcms.repackage.jersey.jar"
                      dotcmsJar="${lib.app}/dotcms_${dotcms.release.version}.jar"
                      dotVersion="${dotcms.release.version}"
                      generateRulesFromParentFolder="true"
                      renameservices="true"
                      jspFolder="${dotcms.dir}">

            <fileset dir=".">
                <include name="**/*.jar"/>
                <exclude name="jersey-multipart-1.12.jar"/>
                <exclude name="jersey-server-1.12.jar"/>
                <exclude name="jersey-json-1.12.jar"/>
            </fileset>

            <!--List of dependencies to check if there are dependencies to old packages -->
            <dependency path="${web-inf.dir}/web.xml"/>

        </packagerTask>

        <!--jersey-multipart-->
        <packagerTask outputFolder="${lib.app}"
                      outputFile="com.dotcms.repackage.jersey-multipart.jar"
                      dotcmsJar="${lib.app}/dotcms_${dotcms.release.version}.jar"
                      dotVersion="${dotcms.release.version}"
                      generateRulesFromParentFolder="true"
                      skipdependenciesreplacement="true"
                      renameservices="true"
                      jspFolder="${dotcms.dir}">

            <fileset dir=".">
                <include name="jersey-multipart-1.12.jar"/>
            </fileset>

        </packagerTask>

        <!--jersey-server-->
        <packagerTask outputFolder="${lib.app}"
                      outputFile="com.dotcms.repackage.jersey-server.jar"
                      dotcmsJar="${lib.app}/dotcms_${dotcms.release.version}.jar"
                      dotVersion="${dotcms.release.version}"
                      generateRulesFromParentFolder="true"
                      skipdependenciesreplacement="true"
                      renameservices="true"
                      jspFolder="${dotcms.dir}">

            <fileset dir=".">
                <include name="jersey-server-1.12.jar"/>
            </fileset>

        </packagerTask>

        <!--jersey-json-->
        <packagerTask outputFolder="${lib.app}"
                      outputFile="com.dotcms.repackage.jersey-json.jar"
                      dotcmsJar="${lib.app}/dotcms_${dotcms.release.version}.jar"
                      dotVersion="${dotcms.release.version}"
                      generateRulesFromParentFolder="true"
                      skipdependenciesreplacement="true"
                      renameservices="true"
                      jspFolder="${dotcms.dir}">

            <fileset dir=".">
                <include name="jersey-json-1.12.jar"/>
            </fileset>

        </packagerTask>

    </target>

</project>