<project name="Repackager - Commons" default="repackage">

    <property file="${basedir}/../../src/com/liferay/portal/util/build.properties"/>
    <property name="lib.app" value="${basedir}/../../dotCMS/WEB-INF/lib"/>
    <property name="web-inf.dir" value="${basedir}/../../dotCMS/WEB-INF"/>
    <property name="dotcms.dir" value="${basedir}/../../dotCMS"/>
    <property name="src-conf.dir" value="${basedir}/../../src-conf"/>
    <property name="output.file" value="com.dotcms.repackage.commons.jar"/>

    <path id="files-classpath">
        <fileset dir="${lib.app}">
            <include name="jarjar-1.4.jar" />
            <include name="packager-taks.jar" />
        </fileset>

        <fileset dir="../buildlibs">
            <include name="commons-io-2.0.1.jar" />
        </fileset>
    </path>

    <target name="clean">
        <delete file="${lib.app}/${output.file}" failonerror="false" />
    </target>

    <target name="repackage" depends="clean">

        <taskdef classname="com.tonicsystems.jarjar.PackagerTask" name="packagerTask">
            <classpath>
                <path refid="files-classpath" />
            </classpath>
        </taskdef>

        <packagerTask outputFolder="${lib.app}"
                      outputFile="${output.file}"
                      dotcmsJar="${lib.app}/dotcms_${dotcms.release.version}.jar"
                      dotVersion="${dotcms.release.version}"
                      jspFolder="${dotcms.dir}">

            <fileset dir=".">
                <include name="**/*.jar"/>
            </fileset>

            <!--List of dependencies to check if there are dependencies to old packages -->
            <dependency path="${lib.app}/jasperreports-3.5.0.jar"/>
            <dependency path="${lib.app}/struts.jar"/>
            <dependency path="${lib.app}/groovy-all-1.7.0.jar"/>
            <dependency path="${lib.app}/hadoop-0.20.3-dev-core.jar"/>
            <!--<dependency path="${lib.app}/dotcms_log4j.jar"/>--><!--TODO: I think I should check dependecies here!!-->
            <dependency path="${lib.app}/jcaptcha-mod.jar"/>
            <!--<dependency path="${lib.app}/esapi-2.0.1.jar"/>-->
            <dependency path="${lib.app}/quartz-all-1.8.6.jar"/>
            <dependency path="${lib.app}/apache-solr-core-1.4.0.jar"/>
            <dependency path="${lib.app}/dwr_3rc2modified.jar"/>
            <dependency path="${lib.app}/fileupload-ext.jar"/>
            <dependency path="${lib.app}/milton-servlet-1.8.1.4.jar"/>
            <dependency path="${lib.app}/org.springframework.web-3.1.0.RELEASE.jar"/>
            <dependency path="${lib.app}/apache-solr-solrj-1.4.0.jar"/>
            <dependency path="${lib.app}/ee-96daf56ad45c.jar"/>
            <dependency path="${lib.app}/ldap.jar"/>
            <dependency path="${lib.app}/tika-app-1.3.jar"/>
            <dependency path="${lib.app}/urlrewritefilter-4.0.3.jar"/>
            <dependency path="${lib.app}/milton-api-1.8.1.4.jar"/>
            <dependency path="${lib.app}/drools-compiler-3.0.5.jar"/>
            <dependency path="${lib.app}/hibernate2.jar"/>

            <!--<dependency path="${lib.app}/com.dotcms.repackage.chemistry.jar"/>--><!--FIXME: I don't like this dependency, fixme!!-->

            <dependency path="${web-inf.dir}/validator-rules.xml"/>
            <dependency path="${web-inf.dir}/felix/osgi-extra.conf"/>
            <dependency path="${src-conf.dir}/dotmarketing-config.properties"/>

        </packagerTask>

    </target>

</project>